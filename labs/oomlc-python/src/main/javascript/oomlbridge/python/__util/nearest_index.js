let nearest_index = (seq, i) => {
  return Math.max(0, Math.min(seq.length, i));
};
